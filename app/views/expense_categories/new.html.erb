<%= render partial: 'form', locals: { user_category: @user_category, expense_category: @expense_category } %>
<%= render partial: 'form' %>

<script>
  $(document).on('submit', '#new_expense', function(e) {
    e.preventDefault();
    const formData = $(this).serialize();
    const url = $(this).attr('action');
    $.ajax({
      type: 'POST',
      url: url,
      data: formData,
      success: function(response) {
        $('#new_expense')[0].reset();
        App.notifications.send('A new expense has been added.');
      }
    });
  });

  // Mark all notifications as read
  $(document).on('click', '#mark-all-as-read-button', function() {
    $.ajax({
      type: 'PUT',
      url: '/notifications/mark_all_as_read',
      success: function(response) {
        $('#notifications-list li').addClass('read');
      }
    });
  });

  // Initialize Action Cable
  App.notifications = App.cable.subscriptions.create('NotificationsChannel', {
    received: function(data) {
      $('#notifications-list').prepend(data.notification);
    }
  });
</script>

<script>
  $(document).on('submit', '#new_expense', function(e) {
    e.preventDefault();
    const formData = $(this).serialize();
    const url = $(this).attr('action');
    $.ajax({
      type: 'POST',
      url: url,
      data: formData,
      success: function(response) {
        $('#new_expense')[0].reset();
        App.notifications.send('A new expense has been added.');
      }
    });
  });

  // Mark all notifications as read
  $(document).on('click', '#mark-all-as-read-button', function() {
    $.ajax({
      type: 'PUT',
      url: '/notifications/mark_all_as_read',
      success: function(response) {
        $('#notifications-list li').addClass('read');
      }
    });
  });

  // Initialize Action Cable
  App.notifications = App.cable.subscriptions.create('NotificationsChannel', {
    received: function(data) {
      $('#notifications-list').prepend(data.notification);
    }
  });
</script>